---
import Layout from "../layouts/BaseLayout.astro";
import Link from "../components/Link.astro";
const props = {
    title: "",
    description: "",
    image: "home",
};
import torahReadingsJson from "../../public/torah_readings.json";
import { TorahReadings, TorahReadingType } from "./data";

let parsedTorahReadings: TorahReadingType[] = [];
let error;

try {
    parsedTorahReadings = TorahReadings.parse(torahReadingsJson);
} catch (err) {
    error = err;
    console.error("Error validating Torah readings data:", err);
}
---

<Layout {...props}>
    <nav>
        <ul>
            {
                parsedTorahReadings.map((reading) => (
                    <li>
                        <Link href={`#week-${reading.week}`}>
                            Week {reading.week}
                        </Link>
                    </li>
                ))
            }
        </ul>
    </nav>
    <main>
        {
            error ? (
                <p>
                    Sorry, there was an error loading the Torah readings data.
                </p>
            ) : (
                <>
                    {parsedTorahReadings.map((reading) => (
                        <article>
                            <span id={`week-${reading.week}`}>
                                {" "}
                                Week {reading.week}
                            </span>
                            <h3>
                                <i>{reading.portion.hebrew}</i>
                            </h3>
                            <p>{reading.portion.english}</p>
                            <ul>
                                <li>
                                    Torah: {reading.book} {reading.verses}
                                </li>
                                <li>Torah Resources</li>
                                <ul>
                                    <li>
                                        Haftarah:{" "}
                                        {reading.torah_resource.haftarah.map(
                                            (haftarah, index) => (
                                                <span>
                                                    {(index > 0 ? ", " : "") +
                                                        haftarah.book +
                                                        " " +
                                                        haftarah.verses +
                                                        (index === 0
                                                            ? "(E)"
                                                            : "(H)")}
                                                </span>
                                            )
                                        )}{" "}
                                    </li>

                                    <li>
                                        Apostolic:{" "}
                                        {reading.torah_resource.apostolic.book}{" "}
                                        {
                                            reading.torah_resource.apostolic
                                                .verses
                                        }
                                    </li>
                                </ul>
                                <li>FFOZ</li>
                                <ul>
                                    <li>
                                        Prophets:{" "}
                                        {reading.ffoz.prophets.map(
                                            (prophet, index) => (
                                                <span>
                                                    {(index > 0 ? ", " : "") +
                                                        prophet.book +
                                                        " " +
                                                        prophet.verses}
                                                </span>
                                            )
                                        )}
                                    </li>

                                    <li>
                                        Gospel:{" "}
                                        {reading.ffoz.gospel.map(
                                            (gospelItem, index) => (
                                                <span>
                                                    {(index > 0 ? ", " : "") +
                                                        gospelItem.book +
                                                        " " +
                                                        gospelItem.verses}
                                                </span>
                                            )
                                        )}
                                    </li>
                                </ul>
                            </ul>
                        </article>
                    ))}
                </>
            )
        }
    </main>
</Layout>
